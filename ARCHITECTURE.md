# ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

## ĞĞ±Ğ·Ğ¾Ñ€ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Telegram Bot   â”‚
â”‚   (@BotFather)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ initData
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Telegram Mini App              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         React Frontend            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚  Components:             â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - Header (Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ)     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - QuestionCard (ÑĞ²Ğ°Ğ¹Ğ¿)  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - SwipeButtons          â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - ExplanationModal      â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚  State (Zustand):        â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - user                  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - questions             â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - stats                 â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ REST API
                   â”‚ (fetch)
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Node.js Backend (Express)       â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  API Endpoints:                    â”‚ â”‚
â”‚  â”‚  POST /api/auth/login              â”‚ â”‚
â”‚  â”‚  GET  /api/questions/feed          â”‚ â”‚
â”‚  â”‚  POST /api/questions/swipe         â”‚ â”‚
â”‚  â”‚  POST /api/questions/explain       â”‚ â”‚
â”‚  â”‚  GET  /api/stats                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Services:                         â”‚ â”‚
â”‚  â”‚  - aiService (OpenRouter)          â”‚ â”‚
â”‚  â”‚  - telegram (Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ)            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚               â”‚
               â”‚               â”‚ HTTP Request
               â”‚               â–¼
               â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚    â”‚   OpenRouter API     â”‚
               â”‚    â”‚  (AI Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ)      â”‚
               â”‚    â”‚  google/gemini-2.0   â”‚
               â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ SQL Queries
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          PostgreSQL Database             â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Table: users                    â”‚   â”‚
â”‚  â”‚  - telegram_id (PK)              â”‚   â”‚
â”‚  â”‚  - username, first_name          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Table: questions                â”‚   â”‚
â”‚  â”‚  - id (PK)                       â”‚   â”‚
â”‚  â”‚  - category                      â”‚   â”‚
â”‚  â”‚  - question_text                 â”‚   â”‚
â”‚  â”‚  - short_answer                  â”‚   â”‚
â”‚  â”‚  - cached_explanation (AI ĞºÑÑˆ)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Table: user_progress            â”‚   â”‚
â”‚  â”‚  - id (PK)                       â”‚   â”‚
â”‚  â”‚  - user_id (FK â†’ users)          â”‚   â”‚
â”‚  â”‚  - question_id (FK â†’ questions)  â”‚   â”‚
â”‚  â”‚  - status (known/unknown)        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### 1. ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ

```
User â†’ Telegram Bot â†’ Mini App
                        â†“
                   initData (Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ°)
                        â†“
                   Frontend (React)
                        â†“
                   POST /api/auth/login
                        â†“
                   Backend Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ initData
                        â†“
                   Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ user Ğ² Ğ‘Ğ”
                        â†“
                   Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ user Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
                        â†“
                   Frontend ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ² Zustand
```

### 2. ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

```
Frontend (mounted)
    â†“
GET /api/questions/feed?userId=X&limit=10
    â†“
Backend:
    1. Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ²Ğ¸Ğ´ĞµĞ»
    2. Ğ˜Ğ»Ğ¸ Ğ²Ğ¸Ğ´ĞµĞ» Ğ´Ğ°Ğ²Ğ½Ğ¾ Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ğ» Ğ½ĞµĞ²ĞµÑ€Ğ½Ğ¾
    3. Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾ (RANDOM())
    â†“
Frontend Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¼Ğ°ÑÑĞ¸Ğ² questions
    â†“
ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ ÑÑ‚ĞµĞºĞ¾Ğ¼
```

### 3. Ğ¡Ğ²Ğ°Ğ¹Ğ¿ Ğ²Ğ¿Ñ€Ğ°Ğ²Ğ¾ (Ğ—Ğ½Ğ°Ñ)

```
User ÑĞ²Ğ°Ğ¹Ğ¿Ğ°ĞµÑ‚ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºÑƒ â†’
    â†“
Frontend: onSwipe('right')
    â†“
POST /api/questions/swipe
    body: { userId, questionId, status: 'known' }
    â†“
Backend:
    INSERT/UPDATE user_progress
    SET status = 'known'
    â†“
Frontend:
    - ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½ÑƒÑ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ
    - ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ÑĞ»ĞµĞ´ÑƒÑÑ‰ÑƒÑ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºÑƒ
    - ĞŸĞ¾Ğ´Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ ĞµÑĞ»Ğ¸ < 3 Ğ¾ÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ
```

### 4. Ğ¡Ğ²Ğ°Ğ¹Ğ¿ Ğ²Ğ»ĞµĞ²Ğ¾ (ĞĞµ Ğ·Ğ½Ğ°Ñ)

```
User ÑĞ²Ğ°Ğ¹Ğ¿Ğ°ĞµÑ‚ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºÑƒ â†
    â†“
Frontend: onSwipe('left')
    â†“
1) POST /api/questions/swipe
   body: { userId, questionId, status: 'unknown' }
    â†“
2) POST /api/questions/explain
   body: { questionId }
    â†“
Backend Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ cached_explanation:
    â†“
    Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ğ² ĞºÑÑˆĞµ â†’ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑÑ€Ğ°Ğ·Ñƒ
    â†“
    Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚:
        1. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ² OpenRouter API
        2. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ AI Ğ¾Ğ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ğµ
        3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ² questions.cached_explanation
        4. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ
    â†“
Frontend:
    - ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ ExplanationModal
    - ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ skeleton (loading)
    - ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ Markdown Ğ¾Ñ‚Ğ²ĞµÑ‚
    - ĞšĞ½Ğ¾Ğ¿ĞºĞ° "Ğ”Ğ°Ğ»ĞµĞµ" â†’ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ°Ñ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ°
```

## ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Frontend

### Header.jsx
```
ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚:
- ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
- ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ: "Ğ˜Ğ·ÑƒÑ‡ĞµĞ½Ğ¾: 12 / 500"
- Progress bar Ñ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹
```

### QuestionCard.jsx
```
Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:
- ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ° (front)
- ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ ĞºÑ€Ğ°Ñ‚ĞºĞ¾Ğ³Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° (back)
- Flip Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ ĞºĞ»Ğ¸ĞºÑƒ
- Swipe Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸ĞºĞ° (react-tinder-card)
- Ğ¦Ğ²ĞµÑ‚Ğ¾Ğ²Ğ°Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ:
- onClick â†’ flip ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸
- onSwipe(direction) â†’ Ğ¿ĞµÑ€ĞµĞ´Ğ°ĞµÑ‚ Ğ² Ñ€Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ñ
```

### SwipeButtons.jsx
```
Ğ”Ğ²Ğµ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸:
- âŒ ĞĞµ Ğ·Ğ½Ğ°Ñ (Ğ»ĞµĞ²Ğ°Ñ, ĞºÑ€Ğ°ÑĞ½Ğ°Ñ)
- âœ… Ğ—Ğ½Ğ°Ñ (Ğ¿Ñ€Ğ°Ğ²Ğ°Ñ, Ğ·ĞµĞ»ĞµĞ½Ğ°Ñ)

ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ½Ğ¾ Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€ÑÑ‚ swipe Ğ½Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞµ
```

### ExplanationModal.jsx
```
Bottom sheet Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾:
- ĞĞ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ÑĞ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞ½Ğ¸Ğ·Ñƒ
- Loading ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ (spinner)
- Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ Markdown (react-markdown)
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° code blocks
- ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ
```

### App.jsx
```
Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚:
- Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Telegram WebApp
- ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‚ĞµĞºĞ¾Ğ¼ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞµĞº
- ĞšĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸
```

## Backend API Endpoints

### POST /api/auth/login
```javascript
Input:  { initData: "string" }
Action: Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· crypto, ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ user
Output: { success: true, user: {...} }
```

### GET /api/questions/feed
```javascript
Query:  userId=X, limit=10
Action: SELECT Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ñ LEFT JOIN user_progress
Output: { questions: [...] }

SQL Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°:
WHERE up.id IS NULL          -- Ğ½Ğµ Ğ²Ğ¸Ğ´ĞµĞ»
   OR up.status = 'unknown'  -- Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ğ» Ğ½ĞµĞ²ĞµÑ€Ğ½Ğ¾
ORDER BY RANDOM()
```

### POST /api/questions/swipe
```javascript
Input:  { userId, questionId, status: 'known'|'unknown' }
Action: INSERT INTO user_progress ON CONFLICT UPDATE
Output: { success: true }
```

### POST /api/questions/explain
```javascript
Input:  { questionId }
Action: 
  1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ cached_explanation
  2. Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚ â†’ Ğ²Ñ‹Ğ·Ğ²Ğ°Ñ‚ÑŒ OpenRouter API
  3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ² ĞºÑÑˆ
Output: { explanation: "markdown", cached: boolean }

OpenRouter request:
POST https://openrouter.ai/api/v1/chat/completions
{
  model: "google/gemini-2.0-flash-lite-preview-02-05:free",
  messages: [
    { role: "system", content: SYSTEM_PROMPT },
    { role: "user", content: "ĞĞ±ÑŠÑÑĞ½Ğ¸: ..." }
  ]
}
```

### GET /api/stats
```javascript
Query:  userId=X
Action: COUNT(*) FILTER (WHERE status = 'known/unknown')
Output: { known, unknown, totalSeen, totalQuestions }
```

## State Management (Zustand)

```javascript
const store = {
  // Auth
  user: null,
  isAuthenticated: false,
  
  // Questions
  questions: [],      // Ğ¼Ğ°ÑÑĞ¸Ğ² Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
  currentIndex: 0,    // Ğ¸Ğ½Ğ´ĞµĞºÑ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸
  
  // Stats
  stats: {
    known: 0,
    unknown: 0,
    totalSeen: 0,
    totalQuestions: 0
  },
  
  // Modal
  showExplanation: false,
  currentExplanation: null,
  isLoadingExplanation: false,
  
  // Actions
  login(initData),
  loadQuestions(),
  swipeCard(questionId, direction),
  loadExplanation(questionId),
  closeExplanation()
}
```

## Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Ğ¡Ğ²ÑĞ·Ğ¸

```
users (1) â”€â”€â”€< (M) user_progress
                       â”‚
                       â”‚ (M) >â”€â”€â”€ (1) questions
                       
user_progress ÑĞ²ÑĞ·Ñ‹Ğ²Ğ°ĞµÑ‚ users Ğ¸ questions
(Many-to-Many Ñ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ¿Ğ¾Ğ»ÑĞ¼Ğ¸)
```

### Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹

```sql
-- Ğ”Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
idx_user_progress_user_id ON user_progress(user_id)

-- Ğ”Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ²ÑĞµÑ… Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ
idx_user_progress_question_id ON user_progress(question_id)

-- Ğ”Ğ»Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼
idx_questions_category ON questions(category)
```

## ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### 1. ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ AI Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²
```
questions.cached_explanation â†’ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚
Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ‚: Ñ‚Ğ¾ĞºĞµĞ½Ñ‹, Ğ²Ñ€ĞµĞ¼Ñ, Ğ´ĞµĞ½ÑŒĞ³Ğ¸
```

### 2. ĞŸÑ€ĞµĞ´Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
```
ĞšĞ¾Ğ³Ğ´Ğ° Ğ¾ÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ < 3 Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ° â†’ Ğ¿Ğ¾Ğ´Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ ĞµÑ‰Ğµ 10
ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ¶Ğ´ĞµÑ‚
```

### 3. Ğ‘Ğ°Ñ‚Ñ‡Ğ¸Ğ½Ğ³
```
Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ ÑÑ€Ğ°Ğ·Ñƒ 10 Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ², Ğ° Ğ½Ğµ Ğ¿Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ
ĞœĞµĞ½ÑŒÑˆĞµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğº API
```

### 4. Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹ Ğ‘Ğ”
```
Ğ£ÑĞºĞ¾Ñ€ÑÑÑ‚ SELECT Ñ JOIN Ğ¸ WHERE
```

## Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### 1. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Telegram initData
```javascript
HMAC-SHA256 Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸
ĞŸÑ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»ĞºÑƒ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
```

### 2. API Key Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ
```
OPENROUTER_API_KEY Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² Backend
Frontend Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
```

### 3. SQL Injection Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°
```
Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ ($1, $2)
ĞĞ¸ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğµ ĞºĞ¾Ğ½ĞºĞ°Ñ‚ĞµĞ½Ğ¸Ñ€ÑƒĞµĞ¼ SQL ÑÑ‚Ñ€Ğ¾ĞºĞ¸
```

### 4. Rate limiting (TODO)
```
ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğº AI
Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ·Ğ»Ğ¾ÑƒĞ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ğ¹
```

## Production Deployment

```
Frontend (Vercel):
- Static hosting
- CDN
- Automatic HTTPS

Backend (Railway):
- Managed Node.js
- Environment variables
- Logs & metrics

Database (Supabase):
- Managed PostgreSQL
- Automatic backups
- Connection pooling
```

## ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¸ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)

```
1. API Response time
2. AI generation time
3. Cache hit rate (cached_explanation)
4. User engagement:
   - Questions per session
   - Known vs Unknown ratio
   - Daily active users
5. Error rates
```
